<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="keywords" content="translation,go,go101">
<meta property="og:type" content="article">
<meta property="og:title" content="Go 细节">
<meta property="og:url" content="https://lingchao.xin/post/go-details.html">
<meta property="og:site_name" content="Coding talks">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-05-14T06:24:46.838Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Go 细节">
    
    
        
          
              <link rel="shortcut icon" href="https://www.gravatar.com/avatar/f4254a13e728ba649241e5776b4884db?s=16">
          
        
        
          
            <link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/f4254a13e728ba649241e5776b4884db?s=192" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/f4254a13e728ba649241e5776b4884db?s=180">
          
        
    
    <!-- title -->
    <title>Go 细节</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Coding talks" type="application/atom+xml" />
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/atom.xml">Feed</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/post/type-system-overview.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://lingchao.xin/post/go-details.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://lingchao.xin/post/go-details.html&text=Go 细节"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lingchao.xin/post/go-details.html&is_video=false&description=Go 细节"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Go 细节&body=Check out this article: https://lingchao.xin/post/go-details.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://lingchao.xin/post/go-details.html&name=Go 细节&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码包"><span class="toc-number">1.</span> <span class="toc-text">代码包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一个包可以在源文件中多次导入"><span class="toc-number">1.1.</span> <span class="toc-text">一个包可以在源文件中多次导入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#package-mypkg-后的注释-import-“x-y-z-mypkg”-对于-Go-编译器是有意义的"><span class="toc-number">1.2.</span> <span class="toc-text">package mypkg 后的注释 // import “x.y.z.mypkg” 对于 Go 编译器是有意义的</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#流程控制"><span class="toc-number">2.</span> <span class="toc-text">流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#swith-和-select-中的-default-分支可以放在所有-case-分支之前-之后-或者之间"><span class="toc-number">2.1.</span> <span class="toc-text">swith 和 select 中的 default 分支可以放在所有 case 分支之前, 之后, 或者之间.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#defer-匿名函数可以修改嵌套函数的命名返回结果"><span class="toc-number">2.2.</span> <span class="toc-text">defer 匿名函数可以修改嵌套函数的命名返回结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#对于切片-s-循环-for-i-range-s-…-不等于-for-i-0-i-lt-len-s-i-…"><span class="toc-number">2.3.</span> <span class="toc-text">对于切片 s, 循环 for i = range s {…} 不等于 for i = 0; i &lt; len(s); i++ {…}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用-os-Exit-函数退出程序并使用-runtime-Goexit-函数退出-goroutine"><span class="toc-number">2.4.</span> <span class="toc-text">使用 os.Exit 函数退出程序并使用 runtime.Goexit 函数退出 goroutine</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#指针"><span class="toc-number">3.</span> <span class="toc-text">指针</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#对于数值指针-p-表达式-p-相当于-p-如果-p-不是数值指针-则-p-编译不过"><span class="toc-number">3.1.</span> <span class="toc-text">对于数值指针 p, 表达式 p++ 相当于 (p)++. 如果 p 不是数值指针, 则 *p++ 编译不过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如果两种类型的基本类型相同-则两个命名指针类型的值可以相互转换-两种指针类型的底层类型可能不同"><span class="toc-number">3.2.</span> <span class="toc-text">如果两种类型的基本类型相同, 则两个命名指针类型的值可以相互转换. 两种指针类型的底层类型可能不同.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#不同零大小的值的地址可能相同也可能不同"><span class="toc-number">3.3.</span> <span class="toc-text">不同零大小的值的地址可能相同也可能不同.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#指针类型的基类型可能是指针类型本身"><span class="toc-number">3.4.</span> <span class="toc-text">指针类型的基类型可能是指针类型本身</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关于选择器的细节"><span class="toc-number">3.5.</span> <span class="toc-text">关于选择器的细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器"><span class="toc-number">4.</span> <span class="toc-text">容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#嵌套复合字面量可以简化"><span class="toc-number">4.1.</span> <span class="toc-text">嵌套复合字面量可以简化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在某些情况下-可以使用数组指针作为数组"><span class="toc-number">4.2.</span> <span class="toc-text">在某些情况下, 可以使用数组指针作为数组</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Go 细节
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Coding talks</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-05-08T08:45:15.000Z" itemprop="datePublished">2018-05-08</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/go/">go</a>, <a class="tag-link" href="/tags/go101/">go101</a>, <a class="tag-link" href="/tags/translation/">translation</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css"><div class=".article-gallery" <p="">本文译自 <a href="https://go101.org/article/details.html" target="_blank" rel="noopener">Go Details 101</a> 版权@归原文所有.<p></p>
<h3 id="代码包"><a href="#代码包" class="headerlink" title="代码包"></a>代码包</h3><h4 id="一个包可以在源文件中多次导入"><a href="#一个包可以在源文件中多次导入" class="headerlink" title="一个包可以在源文件中多次导入"></a>一个包可以在源文件中多次导入</h4><p>Go 源文件可以多次导入相同的包, 但导入名称必须不同. 这些相同的包导入引用相同的包实例.</p>
<p>例如:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"io"</span></span><br><span class="line"><span class="keyword">import</span> inout <span class="string">"io"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(&amp;inout.EOF == &amp;io.EOF) <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="package-mypkg-后的注释-import-“x-y-z-mypkg”-对于-Go-编译器是有意义的"><a href="#package-mypkg-后的注释-import-“x-y-z-mypkg”-对于-Go-编译器是有意义的" class="headerlink" title="package mypkg 后的注释 // import “x.y.z.mypkg” 对于 Go 编译器是有意义的"></a>package mypkg 后的注释 // import “x.y.z.mypkg” 对于 Go 编译器是有意义的</h4><p>例如, 当导入此包的源文件由标准 Go 编译器编译时, 以下包的导入路径必须为 “x.y.z.mypkg”.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> mypkg <span class="comment">// import "x.y.z.mypkg"</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><h4 id="swith-和-select-中的-default-分支可以放在所有-case-分支之前-之后-或者之间"><a href="#swith-和-select-中的-default-分支可以放在所有-case-分支之前-之后-或者之间" class="headerlink" title="swith 和 select 中的 default 分支可以放在所有 case 分支之前, 之后, 或者之间."></a>swith 和 select 中的 default 分支可以放在所有 case 分支之前, 之后, 或者之间.</h4><p>与许多其他语言相比, 一个明显的区别在于 switch-case 控制流程块中默认分支的顺序可以是任意的. 例如, 以下三个 switch-case 控制流程块彼此等效.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> n := rand.Intn(<span class="number">3</span>); n &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>: fmt.Println(<span class="string">"n == 0"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>: fmt.Println(<span class="string">"n == 1"</span>)</span><br><span class="line"><span class="keyword">default</span>: fmt.Println(<span class="string">"n == 2"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> n := rand.Intn(<span class="number">3</span>); n &#123;</span><br><span class="line"><span class="keyword">default</span>: fmt.Println(<span class="string">"n == 2"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>: fmt.Println(<span class="string">"n == 0"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>: fmt.Println(<span class="string">"n == 1"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> n := rand.Intn(<span class="number">3</span>); n &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>: fmt.Println(<span class="string">"n == 0"</span>)</span><br><span class="line"><span class="keyword">default</span>: fmt.Println(<span class="string">"n == 2"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>: fmt.Println(<span class="string">"n == 1"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="defer-匿名函数可以修改嵌套函数的命名返回结果"><a href="#defer-匿名函数可以修改嵌套函数的命名返回结果" class="headerlink" title="defer 匿名函数可以修改嵌套函数的命名返回结果"></a>defer 匿名函数可以修改嵌套函数的命名返回结果</h4><p>例如:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Triple</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="params">(r <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		r += n <span class="comment">// modify the return value</span></span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> n + n <span class="comment">// &lt;=&gt; r = n + n; return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(Triple(<span class="number">5</span>)) <span class="comment">// 15</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="对于切片-s-循环-for-i-range-s-…-不等于-for-i-0-i-lt-len-s-i-…"><a href="#对于切片-s-循环-for-i-range-s-…-不等于-for-i-0-i-lt-len-s-i-…" class="headerlink" title="对于切片 s, 循环 for i = range s {…} 不等于 for i = 0; i &lt; len(s); i++ {…}"></a>对于切片 s, 循环 for i = range s {…} 不等于 for i = 0; i &lt; len(s); i++ {…}</h4><p>对于两个循环, 迭代变量 i 的相应最终值可能不同.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fa</span><span class="params">(s []<span class="keyword">int</span>, n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	i = n</span><br><span class="line">	<span class="keyword">for</span> i = <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); i++ &#123;&#125;</span><br><span class="line">	<span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fb</span><span class="params">(s []<span class="keyword">int</span>, n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	i = n</span><br><span class="line">	<span class="keyword">for</span> i = <span class="keyword">range</span> s &#123;&#125;</span><br><span class="line">	<span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := []<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">	fmt.Println(fa(s, <span class="number">-1</span>), fb(s, <span class="number">-1</span>)) <span class="comment">// 6 5</span></span><br><span class="line">	s = <span class="literal">nil</span></span><br><span class="line">	fmt.Println(fa(s, <span class="number">-1</span>), fb(s, <span class="number">-1</span>)) <span class="comment">// 0 -1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用-os-Exit-函数退出程序并使用-runtime-Goexit-函数退出-goroutine"><a href="#使用-os-Exit-函数退出程序并使用-runtime-Goexit-函数退出-goroutine" class="headerlink" title="使用 os.Exit 函数退出程序并使用 runtime.Goexit 函数退出 goroutine"></a>使用 os.Exit 函数退出程序并使用 runtime.Goexit 函数退出 goroutine</h4><p>我们可以通过调用 os.Exit 函数从任何函数中退出程序. os.Exit 函数调用取一个 int 码作为参数并且将该码返回给操作系统.</p>
<p>例如:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// exit-example.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"os"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">select</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ go run a.go</span><br><span class="line">exit status 1</span><br><span class="line">$ echo $?</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>我们可以通过调用 runtime.Goexit 函数来退出一个 goroutine. runtime.Goexit 函数没有参数.</p>
<p>一个例子:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"runtime"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;c &lt;- <span class="number">1</span>&#125;()</span><br><span class="line">		<span class="keyword">defer</span> fmt.Println(<span class="string">"Go"</span>)</span><br><span class="line">		<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> fmt.Println(<span class="string">"C"</span>)</span><br><span class="line">			runtime.Goexit()</span><br><span class="line">		&#125;()</span><br><span class="line">		fmt.Println(<span class="string">"Java"</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	&lt;-c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><h4 id="对于数值指针-p-表达式-p-相当于-p-如果-p-不是数值指针-则-p-编译不过"><a href="#对于数值指针-p-表达式-p-相当于-p-如果-p-不是数值指针-则-p-编译不过" class="headerlink" title="对于数值指针 p, 表达式 p++ 相当于 (p)++. 如果 p 不是数值指针, 则 *p++ 编译不过"></a>对于数值指针 p, 表达式 <em>p++ 相当于 (</em>p)++. 如果 p 不是数值指针, 则 *p++ 编译不过</h4><p>在 Go 中, 指针不能进行算术运算. 对于指针值 p, 语句 p++ 在 Go 中是非法的. 如果 p 是一个指向数值的指针, 那么 Go 编译器会将 *v++ 视为 (*v)++.</p>
<p>例如:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="keyword">int64</span>(<span class="number">5</span>)</span><br><span class="line">	p := &amp;a</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The following two lines don't compile.</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	p++</span></span><br><span class="line"><span class="comment">	p = (&amp;a) + 8</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	*p++</span><br><span class="line">	fmt.Println(*p, a)   <span class="comment">// 6 6</span></span><br><span class="line">	fmt.Println(p == &amp;a) <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="如果两种类型的基本类型相同-则两个命名指针类型的值可以相互转换-两种指针类型的底层类型可能不同"><a href="#如果两种类型的基本类型相同-则两个命名指针类型的值可以相互转换-两种指针类型的底层类型可能不同" class="headerlink" title="如果两种类型的基本类型相同, 则两个命名指针类型的值可以相互转换. 两种指针类型的底层类型可能不同."></a>如果两种类型的基本类型相同, 则两个命名指针类型的值可以相互转换. 两种指针类型的底层类型可能不同.</h4><p>给定非接口值 x 和非接口类型 T, 假定 x 的类型为 Tx,</p>
<ul>
<li>如果 Tx 和 T 共享相同的底层类型(忽略结构体 tags), 那么 x 可以显示地转换为 T, 尤其当 Tx 或者 T 不是一个定义类型并且它们的底层类型相同(考虑结构体 tags), 那么 x 可以隐式地转换为 T.</li>
<li>如果 Tx 和 T 具有不同的底层类型, 但 Tx 和 T 都是<a href="https://go101.org/article/type-system-overview.html#non-defined-type" target="_blank" rel="noopener">非定义</a>的指针类型, 并且它们的基类型共享相同的底层类型(忽略结构体 tags), 则 x 可以(并且必须)可以显示地转换为 T.</li>
</ul>
<p>一般性例子:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// []int, IntSlice and MySlice share</span></span><br><span class="line">	<span class="comment">// the same underlying type: []int</span></span><br><span class="line">	<span class="keyword">type</span> IntSlice []<span class="keyword">int</span></span><br><span class="line">	<span class="keyword">type</span> MySlice  []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> s  = []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> is = IntSlice&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> ms = MySlice&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> x <span class="keyword">struct</span>&#123;n <span class="keyword">int</span> <span class="string">`foo`</span>&#125;</span><br><span class="line">	<span class="keyword">var</span> y <span class="keyword">struct</span>&#123;n <span class="keyword">int</span> <span class="string">`bar`</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The two lines both fail to compile.</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	is = ms</span></span><br><span class="line"><span class="comment">	ms = is</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Must use explicit conversions here.</span></span><br><span class="line">	is = IntSlice(ms)</span><br><span class="line">	ms = MySlice(is)</span><br><span class="line">	x = <span class="keyword">struct</span>&#123;n <span class="keyword">int</span> <span class="string">`foo`</span>&#125;(y)</span><br><span class="line">	y = <span class="keyword">struct</span>&#123;n <span class="keyword">int</span> <span class="string">`bar`</span>&#125;(x)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Implicit conversions are okay here.</span></span><br><span class="line">	s = is</span><br><span class="line">	is = s</span><br><span class="line">	s = ms</span><br><span class="line">	ms = s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>指针的例子:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">type</span> MyInt <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">type</span> IntPtr *<span class="keyword">int</span></span><br><span class="line">	<span class="keyword">type</span> MyIntPtr *MyInt</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> pi = <span class="built_in">new</span>(<span class="keyword">int</span>) <span class="comment">// type is *int</span></span><br><span class="line">	<span class="keyword">var</span> ip IntPtr = pi <span class="comment">// ok, same underlying type</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// var _ *MyInt = pi // can't convert implicitly</span></span><br><span class="line">	<span class="keyword">var</span> _ = (*MyInt)(pi) <span class="comment">// ok, must explicitly</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// var _ MyIntPtr = pi  // can't convert implicitly</span></span><br><span class="line">	<span class="comment">// var _ = MyIntPtr(pi) // can't convert explicitly</span></span><br><span class="line">	<span class="keyword">var</span> _ MyIntPtr = (*MyInt)(pi)  <span class="comment">// ok</span></span><br><span class="line">	<span class="keyword">var</span> _ = MyIntPtr((*MyInt)(pi)) <span class="comment">// ok</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// var _ MyIntPtr = ip  // can't convert implicitly</span></span><br><span class="line">	<span class="comment">// var _ = MyIntPtr(ip) // can't convert explicitly</span></span><br><span class="line">	<span class="keyword">var</span> _ MyIntPtr = (*MyInt)((*<span class="keyword">int</span>)(ip))  <span class="comment">// ok</span></span><br><span class="line">	<span class="keyword">var</span> _ = MyIntPtr((*MyInt)((*<span class="keyword">int</span>)(ip))) <span class="comment">// ok</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="不同零大小的值的地址可能相同也可能不同"><a href="#不同零大小的值的地址可能相同也可能不同" class="headerlink" title="不同零大小的值的地址可能相同也可能不同."></a>不同零大小的值的地址可能相同也可能不同.</h4><p>两个零大小值的地址是否相等取决于编译器和编译器版本.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	b := <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	x := <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	y := <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	m := [<span class="number">10</span>]<span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	n := [<span class="number">10</span>]<span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	o := [<span class="number">10</span>]<span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	p := [<span class="number">10</span>]<span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(&amp;x, &amp;y, &amp;o, &amp;p)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// For the standard Go compiler (1.10),</span></span><br><span class="line">	<span class="comment">// x, y, o and p escape to heap,</span></span><br><span class="line">	<span class="comment">// but a, b, m and n are allocated on stack.</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(&amp;a == &amp;b) <span class="comment">// false</span></span><br><span class="line">	fmt.Println(&amp;x == &amp;y) <span class="comment">// true</span></span><br><span class="line">	fmt.Println(&amp;a == &amp;x) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(&amp;m == &amp;n) <span class="comment">// false</span></span><br><span class="line">	fmt.Println(&amp;o == &amp;p) <span class="comment">// true</span></span><br><span class="line">	fmt.Println(&amp;n == &amp;p) <span class="comment">// false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中的输出用于标准 Go 编译器 1.10.</p>
<h4 id="指针类型的基类型可能是指针类型本身"><a href="#指针类型的基类型可能是指针类型本身" class="headerlink" title="指针类型的基类型可能是指针类型本身"></a>指针类型的基类型可能是指针类型本身</h4><p>一个例子:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">type</span> P *P</span><br><span class="line">	<span class="keyword">var</span> p P</span><br><span class="line">	p = &amp;p</span><br><span class="line">	p = **************p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样,</p>
<ul>
<li>切片类型的元素类型可以是切片类型本身,</li>
<li>映射类型的元素类型可以是映射类型本身,</li>
<li>管道类型的元素类型可以是管道类型本身,</li>
<li>函数类型的参数和结果类型可以是函数类型本身.</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">type</span> S []S</span><br><span class="line">	<span class="keyword">type</span> M <span class="keyword">map</span>[<span class="keyword">string</span>]M</span><br><span class="line">	<span class="keyword">type</span> C <span class="keyword">chan</span> C</span><br><span class="line">	<span class="keyword">type</span> F <span class="function"><span class="keyword">func</span><span class="params">(F)</span> <span class="title">F</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	<span class="title">s</span> := <span class="title">S</span></span>&#123;<span class="number">0</span>:<span class="literal">nil</span>&#125;</span><br><span class="line">	s[<span class="number">0</span>] = s</span><br><span class="line">	m := M&#123;<span class="string">"Go"</span>: <span class="literal">nil</span>&#125;</span><br><span class="line">	m[<span class="string">"Go"</span>] = m</span><br><span class="line">	c := <span class="built_in">make</span>(C, <span class="number">3</span>)</span><br><span class="line">	c &lt;- c; c &lt;- c; c &lt;- c</span><br><span class="line">	<span class="keyword">var</span> f F</span><br><span class="line">	f = <span class="function"><span class="keyword">func</span><span class="params">(F)</span><span class="title">F</span></span> &#123;<span class="keyword">return</span> f&#125;</span><br><span class="line"></span><br><span class="line">	_ = s[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">	_ = m[<span class="string">"Go"</span>][<span class="string">"Go"</span>][<span class="string">"Go"</span>][<span class="string">"Go"</span>]</span><br><span class="line">	&lt;-&lt;-&lt;-c</span><br><span class="line">	f(f(f(f(f))))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="关于选择器的细节"><a href="#关于选择器的细节" class="headerlink" title="关于选择器的细节"></a>关于选择器的细节</h4><p>对于一个指针值, 不管其类型是否定义, 如果它的(指针)类型的基类型是一个结构体类型, 那么指针值可以访问它引用的结构体值的字段. 但是, 如果指针值的类型是定义的类型, 则该值无法访问其引用的值的方法.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">	x <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(T)</span> <span class="title">m</span><span class="params">()</span></span>&#123;&#125; <span class="comment">// T has one method.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> P *T  <span class="comment">// a defined one-level pointer type.</span></span><br><span class="line"><span class="keyword">type</span> PP *P <span class="comment">// a defined two-level pointer type.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> t T</span><br><span class="line">	<span class="keyword">var</span> tp = &amp;t</span><br><span class="line">	<span class="keyword">var</span> tpp = &amp;tp</span><br><span class="line">	<span class="keyword">var</span> p P = tp</span><br><span class="line">	<span class="keyword">var</span> pp PP = &amp;p</span><br><span class="line">	tp.x = <span class="number">12</span>  <span class="comment">// okay</span></span><br><span class="line">	p.x = <span class="number">34</span>   <span class="comment">// okay</span></span><br><span class="line">	pp.x = <span class="number">56</span>  <span class="comment">// error: type PP has no field or method x</span></span><br><span class="line">	tpp.x = <span class="number">78</span> <span class="comment">// error: type **T has no field or method x)</span></span><br><span class="line"></span><br><span class="line">	tp.m()  <span class="comment">// okay. Type *T also has a "m" method.</span></span><br><span class="line">	p.m()   <span class="comment">// error: type P has no field or method m</span></span><br><span class="line">	pp.m()  <span class="comment">// error: type PP has no field or method m</span></span><br><span class="line">	tpp.m() <span class="comment">// error: type **T has no field or method m</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><h4 id="嵌套复合字面量可以简化"><a href="#嵌套复合字面量可以简化" class="headerlink" title="嵌套复合字面量可以简化"></a>嵌套复合字面量可以简化</h4><p>如果复合字面量嵌套了许多其他复合字面量, 那么这些嵌套复合字面量可以简化为 {…} 形式.</p>
<p>例如, 切片值字面量:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A slcie value of a type whose element type is *[4]byte.</span></span><br><span class="line"><span class="comment">// The element type is a pointer type whose base type is [4]byte.</span></span><br><span class="line"><span class="comment">// The pointer base type is an array type whose element type is byte.</span></span><br><span class="line"><span class="keyword">var</span> heads = []*[<span class="number">4</span>]<span class="keyword">byte</span>&#123;</span><br><span class="line">	&amp;[<span class="number">4</span>]<span class="keyword">byte</span>&#123;<span class="string">'P'</span>, <span class="string">'N'</span>, <span class="string">'G'</span>, <span class="string">' '</span>&#125;,</span><br><span class="line">	&amp;[<span class="number">4</span>]<span class="keyword">byte</span>&#123;<span class="string">'G'</span>, <span class="string">'I'</span>, <span class="string">'F'</span>, <span class="string">' '</span>&#125;,</span><br><span class="line">	&amp;[<span class="number">4</span>]<span class="keyword">byte</span>&#123;<span class="string">'J'</span>, <span class="string">'P'</span>, <span class="string">'E'</span>, <span class="string">'G'</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以简化为:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> heads = []*[<span class="number">4</span>]<span class="keyword">byte</span>&#123;</span><br><span class="line">	&#123;<span class="string">'P'</span>, <span class="string">'N'</span>, <span class="string">'G'</span>, <span class="string">' '</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'G'</span>, <span class="string">'I'</span>, <span class="string">'F'</span>, <span class="string">' '</span>&#125;,</span><br><span class="line">	&#123;<span class="string">'J'</span>, <span class="string">'P'</span>, <span class="string">'E'</span>, <span class="string">'G'</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如下例子中的数组字面量:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> language <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	year <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ = [...]language&#123;</span><br><span class="line">	language&#123;<span class="string">"C"</span>, <span class="number">1972</span>&#125;,</span><br><span class="line">	language&#123;<span class="string">"Python"</span>, <span class="number">1991</span>&#125;,</span><br><span class="line">	language&#123;<span class="string">"Go"</span>, <span class="number">2009</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以简化为:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = [...]language&#123;</span><br><span class="line">	&#123;<span class="string">"C"</span>, <span class="number">1972</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"Python"</span>, <span class="number">1991</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"Go"</span>, <span class="number">2009</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如下是映射值字面量的一个例子:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> LangCategory <span class="keyword">struct</span> &#123;</span><br><span class="line">	dynamic <span class="keyword">bool</span></span><br><span class="line">	strong  <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A value of map type whose key type is a struct type and</span></span><br><span class="line"><span class="comment">// whose element type is another map type "map[string]int".</span></span><br><span class="line"><span class="keyword">var</span> _ = <span class="keyword">map</span>[LangCategory]<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">	LangCategory&#123;<span class="literal">true</span>, <span class="literal">true</span>&#125;: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">		<span class="string">"Python"</span>: <span class="number">1991</span>,</span><br><span class="line">		<span class="string">"Erlang"</span>: <span class="number">1986</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	LangCategory&#123;<span class="literal">true</span>, <span class="literal">false</span>&#125;: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">		<span class="string">"JavaScript"</span>: <span class="number">1995</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	LangCategory&#123;<span class="literal">false</span>, <span class="literal">true</span>&#125;: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">		<span class="string">"Go"</span>:   <span class="number">2009</span>,</span><br><span class="line">		<span class="string">"Rust"</span>: <span class="number">2010</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	LangCategory&#123;<span class="literal">false</span>, <span class="literal">false</span>&#125;: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">		<span class="string">"C"</span>: <span class="number">1972</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以简化为:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = <span class="keyword">map</span>[LangCategory]<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">	&#123;<span class="literal">true</span>, <span class="literal">true</span>&#125;: &#123;</span><br><span class="line">		<span class="string">"Python"</span>: <span class="number">1991</span>,</span><br><span class="line">		<span class="string">"Erlang"</span>: <span class="number">1986</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;<span class="literal">true</span>, <span class="literal">false</span>&#125;: &#123;</span><br><span class="line">		<span class="string">"JavaScript"</span>: <span class="number">1995</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;<span class="literal">false</span>, <span class="literal">true</span>&#125;: &#123;</span><br><span class="line">		<span class="string">"Go"</span>:   <span class="number">2009</span>,</span><br><span class="line">		<span class="string">"Rust"</span>: <span class="number">2010</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;<span class="literal">false</span>, <span class="literal">false</span>&#125;: &#123;</span><br><span class="line">		<span class="string">"C"</span>: <span class="number">1972</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意, 在上面的几个例子中, 每个复合字面量中最后一项之后的逗号不能省略.</p>
<h4 id="在某些情况下-可以使用数组指针作为数组"><a href="#在某些情况下-可以使用数组指针作为数组" class="headerlink" title="在某些情况下, 可以使用数组指针作为数组"></a>在某些情况下, 可以使用数组指针作为数组</h4><p>在许多情况下, 我们可以使用指向数组的指针作为数组.</p>
<p>我们可以通过指向数组的指针来迭代数组的元素. 对于长度较大的数组, 这种方法效率更高, 因为复制指针比复制大数组效率更高. 在下面的例子中, 两个循环块是等价的, 并且都是高效的.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a [<span class="number">100</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, n := <span class="keyword">range</span> &amp;a &#123; <span class="comment">// copying a pointer is cheap</span></span><br><span class="line">		fmt.Println(i, n)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, n := <span class="keyword">range</span> a[:] &#123; <span class="comment">// copying a slice is cheap</span></span><br><span class="line">		fmt.Println(i, n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果第二个迭代参数既不被忽略(用 _ )也不被省略(不写), 那么覆盖零数组指针的范围将会 panic. 在以下示例中, 前两个循环块中的每一个都会打印五个索引, 但最后一个会产生 panic.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> p *[<span class="number">5</span>]<span class="keyword">int</span> <span class="comment">// nil</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, _ := <span class="keyword">range</span> p &#123; <span class="comment">// okay</span></span><br><span class="line">		fmt.Println(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> p &#123; <span class="comment">// okay</span></span><br><span class="line">		fmt.Println(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, n := <span class="keyword">range</span> p &#123; <span class="comment">// panic</span></span><br><span class="line">		fmt.Println(i, n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数组指针也可以用来索引数组元素. 通过 nil 数组指针索引数组元素会产生 panic.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>&#125;</span><br><span class="line">	p := &amp;a</span><br><span class="line">	p[<span class="number">0</span>], p[<span class="number">1</span>] = <span class="number">17</span>, <span class="number">19</span></span><br><span class="line">	fmt.Println(a) <span class="comment">// [17 19 5 7 11]</span></span><br><span class="line">	p = <span class="literal">nil</span></span><br><span class="line">	p[<span class="number">0</span>] = <span class="number">31</span> <span class="comment">// panic</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们也可以从数组指针派生切片. 从 nil 数组指针派生切片会产生 panic.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	pa := &amp;[<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>&#125;</span><br><span class="line">	s := pa[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">	fmt.Println(s) <span class="comment">// [3 5]</span></span><br><span class="line">	pa = <span class="literal">nil</span></span><br><span class="line">	s = pa[<span class="number">1</span>:<span class="number">3</span>] <span class="comment">// panic</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们也可以传递数组指针作为内置的 len 和 cap 函数的参数. 传入 nil 数组指针参数给这两个函数不会产生 panic.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> pa *[<span class="number">5</span>]<span class="keyword">int</span> <span class="comment">// nil</span></span><br><span class="line">fmt.Println(<span class="built_in">len</span>(pa), <span class="built_in">cap</span>(pa)) <span class="comment">// 5 5</span></span><br></pre></td></tr></table></figure></div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/atom.xml">Feed</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码包"><span class="toc-number">1.</span> <span class="toc-text">代码包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一个包可以在源文件中多次导入"><span class="toc-number">1.1.</span> <span class="toc-text">一个包可以在源文件中多次导入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#package-mypkg-后的注释-import-“x-y-z-mypkg”-对于-Go-编译器是有意义的"><span class="toc-number">1.2.</span> <span class="toc-text">package mypkg 后的注释 // import “x.y.z.mypkg” 对于 Go 编译器是有意义的</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#流程控制"><span class="toc-number">2.</span> <span class="toc-text">流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#swith-和-select-中的-default-分支可以放在所有-case-分支之前-之后-或者之间"><span class="toc-number">2.1.</span> <span class="toc-text">swith 和 select 中的 default 分支可以放在所有 case 分支之前, 之后, 或者之间.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#defer-匿名函数可以修改嵌套函数的命名返回结果"><span class="toc-number">2.2.</span> <span class="toc-text">defer 匿名函数可以修改嵌套函数的命名返回结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#对于切片-s-循环-for-i-range-s-…-不等于-for-i-0-i-lt-len-s-i-…"><span class="toc-number">2.3.</span> <span class="toc-text">对于切片 s, 循环 for i = range s {…} 不等于 for i = 0; i &lt; len(s); i++ {…}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用-os-Exit-函数退出程序并使用-runtime-Goexit-函数退出-goroutine"><span class="toc-number">2.4.</span> <span class="toc-text">使用 os.Exit 函数退出程序并使用 runtime.Goexit 函数退出 goroutine</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#指针"><span class="toc-number">3.</span> <span class="toc-text">指针</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#对于数值指针-p-表达式-p-相当于-p-如果-p-不是数值指针-则-p-编译不过"><span class="toc-number">3.1.</span> <span class="toc-text">对于数值指针 p, 表达式 p++ 相当于 (p)++. 如果 p 不是数值指针, 则 *p++ 编译不过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如果两种类型的基本类型相同-则两个命名指针类型的值可以相互转换-两种指针类型的底层类型可能不同"><span class="toc-number">3.2.</span> <span class="toc-text">如果两种类型的基本类型相同, 则两个命名指针类型的值可以相互转换. 两种指针类型的底层类型可能不同.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#不同零大小的值的地址可能相同也可能不同"><span class="toc-number">3.3.</span> <span class="toc-text">不同零大小的值的地址可能相同也可能不同.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#指针类型的基类型可能是指针类型本身"><span class="toc-number">3.4.</span> <span class="toc-text">指针类型的基类型可能是指针类型本身</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关于选择器的细节"><span class="toc-number">3.5.</span> <span class="toc-text">关于选择器的细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器"><span class="toc-number">4.</span> <span class="toc-text">容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#嵌套复合字面量可以简化"><span class="toc-number">4.1.</span> <span class="toc-text">嵌套复合字面量可以简化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在某些情况下-可以使用数组指针作为数组"><span class="toc-number">4.2.</span> <span class="toc-text">在某些情况下, 可以使用数组指针作为数组</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://lingchao.xin/post/go-details.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://lingchao.xin/post/go-details.html&text=Go 细节"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lingchao.xin/post/go-details.html&is_video=false&description=Go 细节"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Go 细节&body=Check out this article: https://lingchao.xin/post/go-details.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://lingchao.xin/post/go-details.html&title=Go 细节"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://lingchao.xin/post/go-details.html&name=Go 细节&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 Lingchao Xin
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/atom.xml">Feed</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-47053188-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'douglarek';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


